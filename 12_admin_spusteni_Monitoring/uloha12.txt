ADMIN SPUŠTĚNÍ

$adminRights = ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)

if (-not $adminRights) {
    Write-Host "Skript byl spusten bez administratorskych prav."

    $scriptPath = $MyInvocation.MyCommand.Definition
    Start-Process -FilePath "powershell.exe" -ArgumentList "-NoProfile -ExecutionPolicy Bypass -File `"$scriptPath`"" -Verb RunAs
    exit
} else {
    Write-Host "Skript byl spusten s administratorskymi pravy."
    #sleep(10) # jinak se okno hned zavře
    Write-Host "Enter pro ukonceni skriptu..."
    $null = $Host.UI.RawUI.ReadKey('NoEcho,IncludeKeyDown')
}

MONITORING

$adresar = "C:\Users\KRoze\Desktop\outlog"
$logSoubor = "C:\Users\KRoze\Desktop\outlog\outlog.txt"

function ZapisDoLogu ($obsah) {
    Add-Content -Path $logSoubor -Value $obsah
}

while ($true) {
    $soubory = Get-ChildItem -Path $adresar -File | Where-Object { $_.CreationTime -gt $posledniKontrola }
    
    foreach ($soubor in $soubory) {
        $jmenoSouboru = $soubor.Name
        $casVytvoreni = $soubor.CreationTime
        $informace = "Novy soubor vytvoren: $jmenoSouboru, Cas: $casVytvoreni"
        ZapisDoLogu $informace
    }

    $posledniKontrola = Get-Date
    Write-Host "Watching the directory..."
    Start-Sleep -Seconds 5
}